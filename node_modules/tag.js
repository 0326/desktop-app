var db = require('db');
var Common = require('common');
var User = require('user');
var Tags = db.tags;
/*
TagId
UserId
Title
NumberNotes
CreatedTime
UpdatedTime
Usn
*/
// 笔记本服务
var Tag = {
	// 添加多个标签
	addTags: function(titles) {
		for(var i in titles) {
			var title = titles[i];
			this.addTag(title);
		}
	},
	// 添加标签, 先查询是否存在
	addTag: function(title, callback) {
		userId = User.getCurActiveUserId();
		Tags.count({UserId: userId, Title: title}, function(err, count) {
			if(count) {
				callback && callback({Ok: false, IsExists: true});
			} else {
				var date = new Date();
				Tags.insert({
					TagId: Common.objectId(), 
					UserId: userId, 
					Title: title, 
					CreatedTime: date,
					UpdatedTime: date
				}, function(err, doc) {
					if(!err) {
						callback && callback({Ok: false, Inserted: false});
					} else {
						callback && callback(doc);
					}
				});
			}
		});
	},
	// 更新标签标题
	updateTagTitle: function(tagId, Title, callback) {
		userId = User.getCurActiveUserId();
		// Tags.update({TagId: tagId, userId: userId}, {$set: {NumberNotes: count}}, {})
		Tags.update({TagId: tagId, userId: userId}, {$set: {Title: title}}, {}, function(err) {
			if(err) {
				callback && callback(false);
			} else {
				callback && callback(true);
			}
		});
	},
	// 得到标签
	getTags: function(callback) {
		Tags.find({UserId: User.getCurActiveUserId()}, function(err, tags) {
			if(err) {
				callback && callback(false);
			} else {
				callback && callback(tags);
			}
		});
	}
};
module.exports = Tag;